#include <mach/mt_typedefs.h>

#define TEMPERATURE_T0                  110
#define TEMPERATURE_T1                  0
#define TEMPERATURE_T2                  25
#define TEMPERATURE_T3                  50
#define TEMPERATURE_T                   255 // This should be fixed, never change the value

#define FG_METER_RESISTANCE 	0

#define MAX_BOOTING_TIME_FGCURRENT	1*10 // 10s

#if defined(CONFIG_POWER_EXT)
#define OCV_BOARD_COMPESATE	72 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
#else
#define OCV_BOARD_COMPESATE	0 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
#endif

#define Q_MAX_POS_50	1542
#define Q_MAX_POS_25	1533
#define Q_MAX_POS_0		1453
#define Q_MAX_NEG_10	1410

#define Q_MAX_POS_50_H_CURRENT	1540
#define Q_MAX_POS_25_H_CURRENT	1528
#define Q_MAX_POS_0_H_CURRENT	1412
#define Q_MAX_NEG_10_H_CURRENT	1283

#define R_FG_VALUE 				20 // mOhm, base is 20
#define CURRENT_DETECT_R_FG	100  //10mA

#define OSR_SELECT_7			0

#define CAR_TUNE_VALUE			100 	//94 //1.00

/////////////////////////////////////////////////////////////////////
// <DOD, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _BATTERY_PROFILE_STRUC
{
    kal_int32 percentage;
    kal_int32 voltage;
} BATTERY_PROFILE_STRUC, *BATTERY_PROFILE_STRUC_P;

typedef enum
{
    T1_0C,
    T2_25C,
    T3_50C
} PROFILE_TEMPERATURE;

// T0 -10C
BATTERY_PROFILE_STRUC battery_profile_t0[] =
{
	{0 , 4153 },
	{1 , 4136 },
	{3 , 4118 },
	{4 , 4096 },
	{6 , 4072 },
	{7 , 4049 },
	{8 , 4030 },
	{10, 4015 },
	{11, 4003 },
	{13, 3992 },
	{14, 3983 },
	{16, 3974 },
	{17, 3966 },
	{18, 3957 },
	{20, 3950 },
	{21, 3942 },
	{23, 3933 },
	{24, 3925 },
	{25, 3916 },
	{27, 3907 },
	{28, 3898 },
	{30, 3889 },
	{31, 3879 },
	{32, 3869 },
	{34, 3860 },
	{35, 3852 },
	{37, 3843 },
	{38, 3836 },  
	{40, 3829 }, 
	{41, 3824 },
	{42, 3818 },
	{44, 3813 },  
	{45, 3808 },
	{47, 3804 },
	{48, 3800 },
	{49, 3797 },
	{51, 3793 },
	{52, 3790 },
	{54, 3787 },
	{55, 3784 },
	{56, 3782 },
	{58, 3779 },
	{59, 3778 },
	{61, 3776 },
	{62, 3774 },
	{64, 3772 },
	{65, 3770 },
	{66, 3767 },
  	{68, 3765 },    
  	{69, 3762 },    
  	{71, 3759 },    
  	{72, 3755 },    
	{73, 3751 },    
	{75, 3747 },    
  	{76, 3742 },    
	{78, 3736 },    
  	{79, 3730 },    
  	{80, 3723 },    
  	{82, 3716 },    
  	{83, 3710 },    
  	{85, 3704 },    
  	{86, 3699 },    
  	{88, 3695 },    
  	{89, 3690 },    
  	{90, 3684 },    
  	{92, 3673 },    
  	{93, 3652 },    
  	{95, 3615 },    
  	{96, 3559 },     
        {97, 3473 },
        {98, 3460 },
        {99, 3450 },
        {100,3440 },
        {100,3440 },
        {100,3440 },
        {100,3440 },
        {100,3440 },
        {100,3440 }
};      
        
// T1 0C 
BATTERY_PROFILE_STRUC battery_profile_t1[] =
{
	{0 , 4148},
	{1 , 4111},
	{3 , 4090},
	{4 , 4076},
	{6 , 4064},
	{7 , 4052},
	{8 , 4040},
	{10, 4027},
	{11, 4016},
	{12, 4005},
	{14, 3994},
	{15, 3985},
	{17, 3976},
	{18, 3967},
	{19, 3959},
	{21, 3951},
	{22, 3943},
	{23, 3936},
	{25, 3928},
	{26, 3921},
	{28, 3913},
	{29, 3906},
	{30, 3898},
	{32, 3890},
	{33, 3882},
	{34, 3873},
	{36, 3863},
	{37, 3853},  
	{39, 3843}, 
	{40, 3834},
	{41, 3826},
	{43, 3819},  
	{44, 3813},
	{45, 3807},
	{47, 3802},
	{48, 3798},
	{50, 3794},
	{51, 3790},
	{52, 3787},
	{54, 3784},
	{55, 3781},
	{56, 3778},
	{58, 3776},
	{59, 3774},
	{61, 3772},
	{62, 3770},
	{63, 3769},
	{65, 3768},
  	{66, 3767},
  	{67, 3766},
  	{69, 3764},
  	{70, 3762},
  	{72, 3761},
  	{73, 3758},
  	{74, 3755},
  	{76, 3752},
  	{77, 3747},
  	{78, 3742},
  	{80, 3736},
  	{81, 3729},
  	{83, 3721},
  	{84, 3714},
  	{85, 3704},
  	{87, 3694},
  	{88, 3687},
  	{89, 3682},
        {91, 3678},  
	{92, 3673},  
	{94, 3667},  
	{95, 3650},
	{96, 3602},
	{98, 3526},
        {99, 3415},
	{100,3410},
	{100,3410},
	{100,3410},
	{100,3410},
        {100,3410}
                  
};	          
// T2 25C         
BATTERY_P96IL3602R battery_profile_t2[] =
{                 
	{0  , 4166},
	{1  , 4145},
	{3  , 4129},
	{4  , 4115},
	{5  , 4102},
	{7  , 4089},
	{8  , 4077},
	{9  , 4065},
	{10 , 4054},
	{12 , 4043},
	{13 , 4032},
	{14 , 4021},
	{16 , 4010},
	{17 , 4000},
	{18 , 3990},
	{20 , 3981},
	{21 , 3972},
	{22 , 3963},
	{23 , 3955},
	{25 , 3946},
	{26 , 3938},
	{27 , 3931},
	{29 , 3923},
	{30 , 3916},
	{31 , 3908},
	{33 , 3902},
	{34 , 3895},
	{35 , 3888},  
	{37 , 3882}, 
	{38 , 3875},
	{39 , 3867},
	{40 , 3859},  
	{42 , 3850},
	{43 , 3839},
	{44 , 3829},
	{46 , 3820},
	{47 , 3812},
	{48 , 3806},
	{50 , 3801},
	{51 , 3796},
	{52 , 3792},
	{53 , 3788},
	{55 , 3784},
	{56 , 3781},
	{57 , 3778},
	{59 , 3775},
	{60 , 3772},
	{61 , 3770},
  	{63 , 3768},
  	{64 , 3766},
  	{65 , 3764},
  	{67 , 3763},
  	{68 , 3762},
  	{69 , 3760},
  	{70 , 3759},
  	{72 , 3757},
  	{73 , 3754},
  	{74 , 3752},
  	{76 , 3748},
  	{77 , 3742},
  	{78 , 3736},
  	{80 , 3731},
  	{81 , 3726},
  	{82 , 3721},
  	{83 , 3714},
  	{85 , 3705},
        {86 , 3697},
        {87 , 3688},
        {89 , 3676},
        {90 , 3671},
        {91 , 3668},
        {93 , 3665},
        {94 , 3660},
        {95 , 3650},
        {97 , 3615},
        {98 , 3552},
        {99 , 3460},
        {100, 3309}

}; 

// T3 50C
BATTERY_PROFILE_STRUC battery_profile_t3[] =
{
	{0  ,  4175},
	{1   , 4157},
	{3   , 4141},
	{4   , 4126},
	{5   , 4112},
	{6   , 4099},
	{8   , 4086},
	{9   , 4074},
	{10  , 4062},
	{12  , 4050},
	{13  , 4039},
	{14  , 4028},
	{16  , 4018},
	{17  , 4007},
	{18  , 3997},
	{19  , 3987},
	{21  , 3978},
	{22  , 3969},
	{23  , 3959},
	{25  , 3951},
	{26  , 3942},
	{27  , 3934},
	{29  , 3926},
	{30  , 3918},
	{31  , 3911},
	{32  , 3903},
	{34  , 3896},
	{35  , 3889},  
	{36  , 3882}, 
	{38  , 3875},
	{39  , 3867},
	{40  , 3858},  
	{42  , 3848},
	{43  , 3839},
	{44  , 3829},
	{45  , 3821},
	{47  , 3813},
	{48  , 3807},
	{49  , 3801},
	{51  , 3797},
	{52  , 3792},
	{53  , 3788},
	{54  , 3784},
	{56  , 3780},
	{57  , 3777},
	{58  , 3774},
	{60  , 3771},
	{61  , 3768},
	{62  , 3766},
	{64  , 3763},
	{65  , 3761},
	{66  , 3759},
	{67  , 3757},
	{69  , 3755},
	{70  , 3752},
	{71  , 3747},
	{73  , 3739},
	{74  , 3734},
	{75  , 3730},
	{77  , 3725},
	{78  , 3720},
	{79  , 3715},
	{80  , 3711},
	{82  , 3706},
	{83  , 3699},
	{84  , 3691},
	{86  , 3683},
	{87  , 3675},
	{88  , 3664},
	{89  , 3657},
	{91  , 3654},
	{92  , 3652},
	{93  , 3648},
	{95  , 3641}, 
	{96  , 3621},
	{97  , 3574},
	{99  , 3505},
	{100 , 3408} 
};            
  
// battery profile for actual temperature. The size should be the same as T1, T2 and T3
BATTERY_PROFILE_STRUC battery_profile_temperature[] =
{
  	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },  
	{0  , 0 }, 
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },  
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 }
};      

/////////////////////////////////////////////////////////////////////
// <Rbat, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _R_PROFILE_STRUC
{
    kal_int32 resistance; // Ohm
    kal_int32 voltage;
} R_PROFILE_STRUC, *R_PROFILE_STRUC_P;

// T0 -10C
R_PROFILE_STRUC r_profile_t0[] =
{
	{457     ,  4153 },
	{457     ,  4136 },
	{464     ,  4118 },
	{470     ,  4096 },
	{496     ,  4072 },
	{533     ,  4049 },
	{575     ,  4030 },
	{605     ,  4015 },
	{619     ,  4003 },
	{625     ,  3992 },
	{632     ,  3983 },
	{641     ,  3974 },
	{644     ,  3966 },
	{647     ,  3957 },
	{649     ,  3950 },
	{653     ,  3942 },
	{653     ,  3933 },
	{657     ,  3925 },
	{655     ,  3916 },
	{659     ,  3907 },
	{659     ,  3898 },
	{663     ,  3889 },
	{661     ,  3879 },
	{665     ,  3869 },
	{667     ,  3860 },
	{671     ,  3852 },
	{674     ,  3843 },
	{677     ,  3836 },  
	{681     ,  3829 }, 
	{684     ,  3824 },
	{688     ,  3818 },
	{689     ,  3813 },  
	{694     ,  3808 },
	{698     ,  3804 },
	{702     ,  3800 },
	{706     ,  3797 },
	{706     ,  3793 },
	{712     ,  3790 },
	{713     ,  3787 },
	{719     ,  3784 },
	{722     ,  3782 },
	{727     ,  3779 },
	{729     ,  3778 },
	{733     ,  3776 },
	{736     ,  3774 },
	{737     ,  3772 },
	{744     ,  3770 },
	{747     ,  3767 },
  	{749     ,  3765 },
  	{752     ,  3762 },
  	{756     ,  3759 },
  	{755     ,  3755 },
  	{760     ,  3751 },
  	{765     ,  3747 },
  	{766     ,  3742 },
  	{767     ,  3736 },
  	{772     ,  3730 },
  	{776     ,  3723 },
  	{782     ,  3716 },
  	{791     ,  3710 },
  	{800     ,  3704 },
  	{805     ,  3699 },
  	{814     ,  3695 },
  	{824     ,  3690 },
  	{834     ,  3684 },
  	{839     ,  3673 },
  	{835     ,  3652 },
  	{818     ,  3615 },
  	{803     ,  3559 },
  	{736     ,  3473 } 
  	{736	 ,  3460 },
  	{736	 ,  3450 },
  	{736	 ,  3440 },
  	{736	 ,  3440 },
  	{736	 ,  3440 },
  	{736	 ,  3440 },
  	{736	 ,  3440 },
  	{736	 ,  3440 } 
};

// T1 0C
R_PROFILE_STRUC r_profile_t1[] =
{
	{271     ,  4148},
	{271     ,  4111},
	{326     ,  4090},
	{346     ,  4076},
	{354     ,  4064},
	{354     ,  4052},
	{357     ,  4040},
	{358     ,  4027},
	{361     ,  4016},
	{361     ,  4005},
	{367     ,  3994},
	{369     ,  3985},
	{372     ,  3976},
	{375     ,  3967},
	{376     ,  3959},
	{378     ,  3951},
	{379     ,  3943},
	{380     ,  3936},
	{381     ,  3928},
	{382     ,  3921},
	{384     ,  3913},
	{384     ,  3906},
	{386     ,  3898},
	{385     ,  3890},
	{387     ,  3882},
	{385     ,  3873},
	{384     ,  3863},
	{382     ,  3853},  
	{385     ,  3843}, 
	{387     ,  3834},
	{390     ,  3826},
	{392     ,  3819},  
	{393     ,  3813},
	{398     ,  3807},
	{400     ,  3802},
	{402     ,  3798},
	{405     ,  3794},
	{407     ,  3790},
	{409     ,  3787},
	{412     ,  3784},
	{412     ,  3781},
	{415     ,  3778},
	{417     ,  3776},
	{419     ,  3774},
	{421     ,  3772},
	{423     ,  3770},
	{426     ,  3769},
	{429     ,  3768},
  	{429     ,  3767},
  	{431     ,  3766},
  	{431     ,  3764},
  	{434     ,  3762},
  	{435     ,  3761},
  	{435     ,  3758},
  	{437     ,  3755},
  	{437     ,  3752},
  	{437     ,  3747},
  	{436     ,  3742},
  	{437     ,  3736},
  	{437     ,  3729},
  	{440     ,  3721},
  	{441     ,  3714},
  	{440     ,  3704},
  	{443     ,  3694},
  	{453     ,  3687},
  	{466     ,  3682},
  	{477     ,  3678},
  	{485     ,  3673},
  	{492     ,  3667},
  	{483     ,  3650},
  	{435     ,  3602},
  	{404     ,  3526},
  	{357     ,  3415},
  	{492     ,  3410},
  	{483     ,  3410},
  	{435     ,  3410},
  	{404     ,  3410},
  	{357     ,  3410} 
}; 

// T2 25C
R_PROFILE_STRUC r_profile_t2[] =
{
	{208     ,  4166},
	{208     ,  4145},
	{220     ,  4129},
	{227     ,  4115},
	{229     ,  4102},
	{231     ,  4089},
	{233     ,  4077},
	{235     ,  4065},
	{235     ,  4054},
	{236     ,  4043},
	{236     ,  4032},
	{237     ,  4021},
	{238     ,  4010},
	{238     ,  4000},
	{240     ,  3990},
	{241     ,  3981},
	{243     ,  3972},
	{243     ,  3963},
	{244     ,  3955},
	{244     ,  3946},
	{245     ,  3938},
	{247     ,  3931},
	{246     ,  3923},
	{247     ,  3916},
	{247     ,  3908},
	{246     ,  3902},
	{249     ,  3895},
	{249     ,  3888},  
	{249     ,  3882}, 
	{248     ,  3875},
	{246     ,  3867},
	{245     ,  3859},  
	{243     ,  3850},
	{240     ,  3839},
	{239     ,  3829},
	{244     ,  3820},
	{247     ,  3812},
	{248     ,  3806},
	{251     ,  3801},
	{252     ,  3796},
	{254     ,  3792},
	{255     ,  3788},
	{257     ,  3784},
	{255     ,  3781},
	{256     ,  3778},
	{259     ,  3775},
	{258     ,  3772},
	{259     ,  3770},
  	{260     ,  3768},
  	{261     ,  3766},
  	{263     ,  3764},
  	{264     ,  3763},
  	{264     ,  3762},
  	{264     ,  3760},
  	{264     ,  3759},
  	{264     ,  3757},
  	{263     ,  3754},
  	{262     ,  3752},
  	{260     ,  3748},
  	{256     ,  3742},
  	{256     ,  3736},
  	{257     ,  3731},
  	{258     ,  3726},
  	{257     ,  3721},
  	{252     ,  3714},
  	{249     ,  3705},
  	{253     ,  3697},
  	{248     ,  3688},
  	{244     ,  3676},
  	{261     ,  3671},
  	{267     ,  3668},
  	{266     ,  3665},
  	{263     ,  3660},
  	{252     ,  3650},
  	{192     ,  3615},
  	{124     ,  3552},
  	{58      ,  3460},
  	{80      ,  3309} 	
};

// T3 50C
R_PROFILE_STRUC r_profile_t3[] =
{
	{202     ,  4175},
	{202     ,  4157},
	{208     ,  4141},
	{210     ,  4126},
	{213     ,  4112},
	{215     ,  4099},
	{216     ,  4086},
	{217     ,  4074},
	{219     ,  4062},
	{220     ,  4050},
	{220     ,  4039},
	{223     ,  4028},
	{224     ,  4018},
	{225     ,  4007},
	{226     ,  3997},
	{227     ,  3987},
	{228     ,  3978},
	{229     ,  3969},
	{228     ,  3959},
	{230     ,  3951},
	{231     ,  3942},
	{231     ,  3934},
	{233     ,  3926},
	{233     ,  3918},
	{235     ,  3911},
	{233     ,  3903},
	{234     ,  3896},
	{235     ,  3889},  
	{236     ,  3882}, 
	{235     ,  3875},
	{232     ,  3867},
	{229     ,  3858},  
	{228     ,  3848},
	{227     ,  3839},
	{229     ,  3829},
	{229     ,  3821},
	{233     ,  3813},
	{236     ,  3807},
	{239     ,  3801},
	{239     ,  3797},
	{239     ,  3792},
	{240     ,  3788},
	{241     ,  3784},
	{241     ,  3780},
	{242     ,  3777},
	{243     ,  3774},
	{244     ,  3771},
	{244     ,  3768},
  	{246     ,  3766},
  	{244     ,  3763},
  	{245     ,  3761},
  	{246     ,  3759},
  	{246     ,  3757},
  	{246     ,  3755},
  	{244     ,  3752},
  	{240     ,  3747},
  	{233     ,  3739},
  	{243     ,  3734},
  	{243     ,  3730},
  	{242     ,  3725},
  	{240     ,  3720},
  	{242     ,  3715},
  	{244     ,  3711},
  	{243     ,  3706},
  	{239     ,  3699},
  	{233     ,  3691},
  	{234     ,  3683},
  	{236     ,  3675},
  	{228     ,  3664},
  	{241     ,  3657},
  	{248     ,  3654},
  	{248     ,  3652},
  	{246     ,  3648},
  	{241     ,  3641},
  	{206     ,  3621},
  	{137     ,  3574},
  	{88      ,  3505},
        {17      ,  3408} 
};      


// r-table profile for actual temperature. The size should be the same as T1, T2 and T3
R_PROFILE_STRUC r_profile_temperature[] =
{
  	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },  
	{0  , 0 }, 
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },  
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 },
	{0  , 0 }
};      


int fgauge_get_saddles(void);
BATTERY_PROFILE_STRUC_P fgauge_get_profile(kal_uint32 temperature);

int fgauge_get_saddles_r_table(void);
R_PROFILE_STRUC_P fgauge_get_profile_r_table(kal_uint32 temperature);

#define CONFIG_POWER_VERIFY
